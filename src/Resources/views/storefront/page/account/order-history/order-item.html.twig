{% sw_extends '@Storefront/storefront/page/account/order-history/order-item.html.twig' %}
{% block page_account_order_item_context_menu_content %}
	{{ parent() }}
	{% set trustpaymentsFormattedHandlerIdentifier = 'handler_trustpaymentspayment_trustpaymentspaymenthandler' %}
	{% set orderPaymentState = order.transactions.last.stateMachineState.technicalName %}
	{% set orderPaymentMethodFormattedHandlerIdentifier = order.transactions.last.paymentMethod.formattedHandlerIdentifier %}
	{% if (trustpaymentsFormattedHandlerIdentifier == orderPaymentMethodFormattedHandlerIdentifier)  and not (orderPaymentState in ['open', 'failed']) %}
		<a class="order-table-header-context-menu-content-link"
		   href="{{ path('frontend.trustpayments.account.order.download.invoice.document', { 'orderId': order.id }) }}">
			{{ "trustpayments.account.downloadInvoice"|trans|sw_sanitize }}
		</a>
	{% endif %}
{% endblock %}
